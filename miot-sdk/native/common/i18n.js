import Utils from"../utils";class I18n{constructor(t,r){this._proxy={};const n=Object.keys(t);if(!n||n.length<1)throw"strings is empty";this._langs=n,this._temp_lang=!1,this._valid_lang=(r=>!(!r||!t[r])&&r),this._default_lang=this._valid_lang(r)||n[0];const e=()=>this._temp_lang||this._default_lang;this._cur_lang=e,function t(r,i){const s={};n.forEach(a=>{const o=i[a];Object.keys(o).forEach(l=>{const g={origin:o[l]};g.isArr=Array.isArray(g.origin);const f=typeof g.origin;g.isObj="object"===f&&!g.isArr,"string"!==f&&"function"!==f||(g.origin=[g.origin],g.isArr=!0);const u=s[l];if(u)g.isObj&&(u.isObj=!0),u.langstr[a]=g;else{const o={isObj:g.isObj,langstr:{[a]:g}};s[l]=o,Object.defineProperty(r,l,{enumerable:!0,configurable:!1,get:()=>{if(!o.pxy)if(o.isObj){o.pxy={};const r={};n.forEach(t=>{o.langstr[t].isObj?r[t]=(i[t]||{})[l]:r[t]={}}),t(o.pxy,r)}else o.pxy=(t=>{let r=o.langstr[t];return r||(n.forEach(t=>{const n=o.langstr[t];n&&n.origin&&(!r||!r.formater&&n.formater)&&(r=n)}),o.langstr[t]=r),r.formater||function t(r){r.isArr?r.formater=Utils.createArrayFormater(r.origin):r.formater=(t=>r.origin),r.formater.valueOf=r.formater,r.formater.inspect=r.formater,r.formater.toString=r.formater,r.formater.translate=((n,...e)=>{if("string"!=typeof n)return r.formater();const i=o.langstr[n];return i&&r!==i?(i.formater||t(i),i.formater(...e)):r.formater(...e)})}(r),r.formater});return o.isObj?o.pxy:o.pxy(e())}})}})})}(this._proxy,t)}get language(){return this._cur_lang()}set language(t){this._temp_lang=this._valid_lang(t)}get defaultLanguage(){return this._default_lang}set defaultLanguage(t){this._default_lang=this._valid_lang(t)||this._default_lang}get strings(){return this._proxy}getString(t,...r){if(!t)return null;if(""==(t=t.replace(/\\s/g,"")))return;const n=t.split(".");let e=this._proxy;for(var i=1;i<n.length;i++){const t=n[i-1];if(""==t)return null;if(!(e=e[t]))return null}if(""==(t=n[n.length-1]))return null;switch(typeof(e=e[t])){case"string":return e;case"function":return e(...r);default:return null}}}export default I18n;