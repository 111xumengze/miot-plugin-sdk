# 常见问题

我们收集了诸多开发者关心的问题。更多问题请大家给本项目直接提 [issues](https://github.com/MiEcosystem/miot-plugin-sdk/issues/new)。

## 高频问题置顶
### npm install安装特别慢
>安装完 Node 后建议设置 npm 镜像以加速后面的过程（或使用科学上网工具）。设置方式为，任意路径下执行以下命令：
    npm config set registry https://registry.npm.taobao.org --global
    npm config set disturl https://npm.taobao.org/dist --global
还可以切换为其他的镜像源，可自行选择

### npm start 报错
>请重新npm install后再试。如果还是不行，请回头 **对照文档仔细检查**。然后移步 [issues](https://github.com/MiEcosystem/miot-plugin-sdk/issues)给我们反馈。
也可以查看RN中文网的 [求助专区](https://bbs.reactnative.cn/category/4/%E6%B1%82%E5%8A%A9%E4%B8%93%E5%8C%BA)

### 我的设备是否开发米家扩展程序？
>请仔细阅读小米IoT开发者网站中的开发引导。我们目前支持 WiFi、BLE、ZigBee（需要网关）通讯的智能设备，NB 目前正在内测，不支持传统经典蓝牙设备。无论何种通讯方式，请尽量适配小米IoT协议，可快速开发，自有协议设备接入请联系我们。米家扩展程序暂时不支持p2p的视频播放，具有这类功能的设备如摄像头，接入请联系米家工作人员，采用其他方式。

### 米家扩展程序是否允许访问自己的后台服务器？
> 禁止直接访问自己的网络服务，需要进行后台对接，否则无法通过审核，详情请咨询米家后台工作人员。

### 蓝牙设备的固件升级（OTA），扩展程序如何处理？
> 扩展程序使用 js 语言，利用SDK提供的蓝牙读写接口实现，直接OTA。

### 后台API返回的错误码
> 米家 App 的云端 API 返回已知错误码：

    0 OK
    -1 没有权限
    -2 设备离线
    -3 超时
    -4 服务器错误
    -5 设备错误
    -6 无效的请求，这个情况比较多，需要日志详查
    -7 未知的设备id
    -8 参数错误，某个参数未设置或设置不对
    -9 未知错误
    -11 重复请求
    -12 请求太频繁，常见合作公司压测接口时返回
    -13 常见于独立app验证，遇到此错误多是6000权限没有通过或scope设置问题
    -17 尚未收到返回结果，多见于异步调用
    -21 语音控制session过期
    -22 分享设备数量超过限制

> 其余错误码请详询后台工作人员

## 设备连接和扩展程序调试
### 开发扩展程序是否支持使用 iOS|Android 模拟器？
> 支持Android模拟器，不支持iOS模拟器，由于要使用 AppStore 版的米家App进行调试，无法在模拟器上运行。

### 为什么我使用 Android 客户端已经绑定了的设备，在iOS的设备列表里却看不到？
> 请联系开发人员将你的产品 model 状态设置为白名单可见。同一个产品，Android 和 iOS 的设置是分开的。

## SDK 和 React Native
### 本地调试时，为什么有时文件明明做了改动（包括添加、修改、删除图片等），但刷新扩展程序却没有发生变化？
> npm 有缓存，遇到这种情况，请按照如下各种操作试试：
>
> 1. 刷新扩展程序
> 2. 使用 npm start --reset-cache 清空重启服务器并清空缓存
> 3. 彻底关闭 terminal 并重新打开
> 4. 重启电脑

### 怎样判断设备离线
> 云端服务器一段时间内收不到设备的心跳包，即判定设备离线。扩展程序中没有实时 API 来判断是否处于在线还是离线状态，用getDevicePropertyFromMemCache方法获取device的isOnline属性，只能判断在进入扩展程序时设备的状态，之后这个值是不会更新的。扩展程序判断设备在线还是离线，可以用与服务器类似的方法，一段时间内(设定一个timer），设备轮询状态一直没有返回（有返回时重置timer），就可以认为设备离线了。

### 页面切换动画怎样取消
>[参见react native github](https://github.com/facebook/react-native/issues/1953)

### 页面怎样切换横竖屏？
> 1. 使用react-native-orientation库处理转屏，参见转屏demo扩展程序
> 2. 需要横竖屏切换的页面需要`Modal`容器作为最顶层视图
> 3. 退出具有横竖屏操作的页面前请还原横竖屏设置为竖屏：`Orientation.lockToPortrait()`

## 测试和发布流程
### 设备重置说明页面如何制作
> 这个页面是个H5，目前不能自动生成，需要设计师人工审核。如果产品有对应的米家的PM对接，请联系PM。需要提供文案和图片（图片的规格是 1080x1725）。

### 设备连接页面顶部的产品图片
> 这个也需要设计师人工审核。需要提供两张图片，尺寸均为 1280x618 ，一张是产品实物图，要求连接指示灯灭。另一张是全透明图，只有对应灯的部分亮，请联系对接的PM或工作人员。（目前也支持提供一个1280x618相同比例的gif）

### 米家App怎么切换到Preview环境
> Android：使用测试包，我的-设置-服务器环境;
iOS：使用测试包，退出登录，再登录时，登录界面最下面选pv