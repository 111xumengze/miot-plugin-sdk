'use strict';var e=require('commander'),o=require('path'),r=require("fs"),i=require("pump"),n=require('compressing'),s=require("./config/common"),a=s.project_dir,t=s.process_dir,c=s.API_LEVEL,l=s.SDK_VERSION,p=s.makeDirsSync;e.version("version:"+l).usage("<packageName>").option("-t, --target [dir]","\u8f93\u51fa\u7684\u76ee\u6807\u6587\u4ef6\u5939","").description("\u6253\u6210\u53d1\u5e03\u5305").parse(process.argv);try{!(function(){if((e.args||[]).length<1)return e.outputHelp(),void process.exit(1001);var s=e.args[0],l=o.join(a,"projects",s),g=o.join(l,"project.json"),u=!(!e.target||!e.target.length)&&e.target,d=o.join(l,"build"),f=u?o.isAbsolute(u)?u:o.join(t,u):o.join(d,"publish.pkg");if(p(o.dirname(f)),p(o.dirname(d)),!r.existsSync(l)||!r.existsSync(g))return console.log("invalid package name"),void process.exit(1002);var m=JSON.parse(r.readFileSync(g).toString());if(m.package_name==s){m.min_sdk_api_level=c,console.log(m),m=Buffer.from(JSON.stringify(m)),console.log("Ready to create publish package file:"),console.log(o.relative(t,f));var j=new n.zip.Stream,v=o.join(d,"project.json");r.writeFileSync(v,m),j.addEntry(v),r.readdirSync(l).forEach(function(e){if(e&&""!=e&&"build"!=e&&"project.json"!=e&&!e.startsWith(".")){var r=o.join(l,e);console.log("compressing:"+e),j.addEntry(r)}}),i(j,r.createWriteStream(f),function(e){e&&console.log("failed to create publish file",e),e||(console.log("Publish package file for publish is generated:"),console.log(f))})}else console.log("invalid package name in project.json")})()}catch(e){console.log(e)}